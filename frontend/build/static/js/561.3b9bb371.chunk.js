(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[561],{3738:function(e,n,t){var r={"./ar.json":2557,"./be.json":8367,"./cs.json":5977,"./de.json":4896,"./en.json":678,"./es.json":2378,"./fa.json":4057,"./fi.json":7453,"./fr.json":364,"./hi.json":7992,"./it.json":9438,"./ja.json":6847,"./kr.json":9983,"./nl.json":1936,"./pl.json":1902,"./pt.json":9761,"./ru.json":8656,"./sa.json":193,"./tr.json":7349,"./uk.json":8329,"./vi.json":1070,"./zh.json":7268};function i(e){var n=s(e);return t(n)}function s(e){if(!t.o(r,e)){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}return r[e]}i.keys=function(){return Object.keys(r)},i.resolve=s,e.exports=i,i.id=3738},9059:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return w}});var r=t(4165),i=t(5861),s=t(9439),o=t(2791),l=t(9434),a=t(4762),u=function(e){return a.W.get("/user/".concat(e))},c=t(184),d=function(e){var n,t,l,a=e.data,d=e.currentUserId,v=e.online,f=(e.userId,e.name,e.avatar,(0,o.useState)(null)),h=(0,s.Z)(f,2),x=h[0],m=h[1];return(0,o.useEffect)((function(){var e,n=null===a||void 0===a||null===(e=a.members)||void 0===e?void 0:e.find((function(e){return e!==d})),t=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u(n);case 3:t=e.sent,i=t.data,m(i),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();t()}),[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{children:(0,c.jsx)("div",{className:"follower conversation",children:(0,c.jsxs)("div",{children:[v&&(0,c.jsx)("div",{className:"online-dot"}),(0,c.jsx)("img",{src:null===x||void 0===x||null===(n=x.user)||void 0===n||null===(t=n.avatar)||void 0===t?void 0:t.url,alt:"",className:"followerImage",style:{width:"50px",height:"50px"}}),(0,c.jsxs)("div",{className:"name",style:{fontSize:"0.8rem"},children:[(0,c.jsx)("span",{children:null===x||void 0===x||null===(l=x.user)||void 0===l?void 0:l.name}),(0,c.jsx)("span",{children:v?"online":"offline"})]})]})})}),(0,c.jsx)("hr",{style:{width:"85%",border:"0.1px solid #ececec"}})]})},v=t(1413),f=t(3433),h=function(e){return a.W.post("/message/",e)},x=t(3688),m=t(724),p=function(e){var n,t,l,d=e.chat,p=e.currentUser,j=e.setSendMessage,g=e.receiveMessage,b=(0,o.useState)(null),Z=(0,s.Z)(b,2),k=Z[0],w=Z[1],N=(0,o.useState)([]),y=(0,s.Z)(N,2),_=y[0],S=y[1],C=(0,o.useState)(""),I=(0,s.Z)(C,2),E=I[0],U=I[1],A=(0,o.useRef)();(0,o.useEffect)((function(){null!==g&&(null===g||void 0===g?void 0:g.chatId)===(null===d||void 0===d?void 0:d._id)&&S((function(e){return[].concat((0,f.Z)(e),[g])}))}),[g,null===d||void 0===d?void 0:d._id]),(0,o.useEffect)((function(){var e,n=null===d||void 0===d||null===(e=d.members)||void 0===e?void 0:e.find((function(e){return e!==p})),t=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u(n);case 3:t=e.sent,i=t.data,w(i),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();null!==d&&t()}),[d,p]),(0,o.useEffect)((function(){var e=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n,t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r=null===d||void 0===d?void 0:d._id,a.W.get("/message/".concat(r));case 3:n=e.sent,t=n.data,S(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}var r}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();null!==d&&e()}),[d]);var W=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(n){var t,i,s,o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),i={senderId:p,text:E,chatId:null===d||void 0===d?void 0:d._id},e.prev=2,e.next=5,h(i);case 5:s=e.sent,o=s.data,S((function(e){return[].concat((0,f.Z)(e),[o])})),U(""),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log(e.t0);case 14:l=null===d||void 0===d||null===(t=d.members)||void 0===t?void 0:t.find((function(e){return e!==p})),j((0,v.Z)((0,v.Z)({},i),{},{receiverId:l}));case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(n){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){var e;null===A||void 0===A||null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[_]),(0,c.jsx)(c.Fragment,{children:(0,c.jsx)("div",{className:"ChatBox-container",children:d?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:"chat-header",children:[(0,c.jsx)("div",{className:"follower",children:(0,c.jsxs)("div",{children:[(0,c.jsx)("img",{src:null===k||void 0===k||null===(n=k.user)||void 0===n||null===(t=n.avatar)||void 0===t?void 0:t.url,alt:"",className:"followerImage",style:{width:"50px",height:"50px"}}),(0,c.jsx)("div",{className:"name",style:{fontSize:"0.8rem"},children:(0,c.jsx)("span",{children:null===k||void 0===k||null===(l=k.user)||void 0===l?void 0:l.name})})]})}),(0,c.jsx)("hr",{style:{width:"85%",border:"0.1px solid #ececec"}})]}),(0,c.jsx)("div",{className:"chat-body",children:null===_||void 0===_?void 0:_.map((function(e,n){return(0,c.jsx)("div",{ref:A,className:(null===e||void 0===e?void 0:e.senderId)===p?"message own":"message ",children:(0,c.jsxs)("div",{children:[(0,c.jsx)("span",{children:null===e||void 0===e?void 0:e.text}),(0,c.jsx)("span",{className:"message-divider",children:" \xb7 "}),(0,c.jsx)("span",{className:"message-time",children:(0,x.WU)(null===e||void 0===e?void 0:e.createdAt)})]})},"".concat(null===e||void 0===e?void 0:e._id,"-").concat((null===e||void 0===e?void 0:e.createdAt)||"defaultCreatedAt","-").concat((null===e||void 0===e?void 0:e.updatedAt)||"defaultUpdatedAt","-").concat(n))}))}),(0,c.jsxs)("div",{className:"chat-sender",children:[(0,c.jsx)("div",{children:"+"}),(0,c.jsx)(m.Z,{value:E,onChange:function(e){U(e)}}),(0,c.jsx)("div",{className:"send-button button",onClick:W,children:"Send"})]})]}):(0,c.jsx)("span",{className:"chatbox-empty-message",children:"Tap on a Chat to start Conversation..."})})})},j=t(1608),g=t(6151),b=t(7580),Z=function(e){var n,t,l,a=e.userId,d=(e.name,e.avatar,(0,o.useState)(null)),v=(0,s.Z)(d,2),f=v[0],h=v[1];return(0,o.useEffect)((function(){var e=function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var n,t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u(a);case 3:n=e.sent,t=n.data,h(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();e()}),[]),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{children:(0,c.jsx)("div",{className:"follower conversation",children:(0,c.jsxs)("div",{children:[(0,c.jsx)("img",{src:null===f||void 0===f||null===(n=f.user)||void 0===n||null===(t=n.avatar)||void 0===t?void 0:t.url,alt:"",className:"followerImage",style:{width:"50px",height:"50px"}}),(0,c.jsx)("div",{className:"name",style:{fontSize:"0.8rem"},children:(0,c.jsx)("span",{children:null===f||void 0===f||null===(l=f.user)||void 0===l?void 0:l.name})})]})})}),(0,c.jsx)("hr",{style:{width:"85%",border:"0.1px solid #ececec"}})]})},k=t(7689),w=function(){var e=(0,l.v9)((function(e){return e.user})).user,n=o.useState(""),t=(0,s.Z)(n,2),u=t[0],v=t[1],f=(0,o.useState)([]),h=(0,s.Z)(f,2),x=h[0],m=h[1],w=(0,o.useState)(null),N=(0,s.Z)(w,2),y=N[0],_=N[1],S=(0,o.useState)([]),C=(0,s.Z)(S,2),I=C[0],E=C[1],U=(0,o.useState)(null),A=(0,s.Z)(U,2),W=A[0],F=A[1],M=(0,o.useState)({}),z=(0,s.Z)(M,2),D=z[0],O=z[1],R=(0,o.useRef)(),T=(0,l.I0)();R.current=(0,j.io)("https://linkupsocial.online/socket.io"),(0,o.useEffect)((function(){return R.current.on("user-blocked",(function(e){e.userId;T((0,b.TX)()),k.Fg})),function(){R.current.off("user-blocked")}}),[]);var L=(0,l.v9)((function(e){return e.allUsers})),q=L.users,B=L.loading;(0,o.useEffect)((function(){null!==W&&R.current.emit("send-message",W)}),[W]),(0,o.useEffect)((function(){R.current.emit("new-user-add",null===e||void 0===e?void 0:e._id),R.current.on("get-users",(function(e){E(e)}))}),[e]);(0,o.useEffect)((function(){R.current.on("receive-message",(function(e){O(e)}))}),[]),(0,o.useEffect)((function(){var n=function(){var n=(0,i.Z)((0,r.Z)().mark((function n(){var t,i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,r=null===e||void 0===e?void 0:e._id,a.W.get("/chat/".concat(r));case 3:t=n.sent,null!==(i=null===t||void 0===t?void 0:t.data)&&void 0!==i?m(i):console.log("Chat data is null or undefined."),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),console.log(n.t0);case 11:case"end":return n.stop()}var r}),n,null,[[0,8]])})));return function(){return n.apply(this,arguments)}}();n()}),[e]);var V=null===q||void 0===q?void 0:q.filter((function(e){return!(null!==x&&void 0!==x&&x.some((function(n){var t;return null===n||void 0===n||null===(t=n.members)||void 0===t?void 0:t.includes(null===e||void 0===e?void 0:e._id)})))})),X=function(){var n=(0,i.Z)((0,r.Z)().mark((function n(t){var i,s,o,l;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,null===y||void 0===y||null===(i=y.members)||void 0===i||!i.includes(t)){n.next=3;break}return n.abrupt("return");case 3:if(null!==W){n.next=7;break}F(t),n.next=8;break;case 7:return n.abrupt("return");case 8:if(s=x.find((function(n){var r,i;return(null===n||void 0===n||null===(r=n.members)||void 0===r?void 0:r.includes(null===e||void 0===e?void 0:e._id))&&(null===n||void 0===n||null===(i=n.members)||void 0===i?void 0:i.includes(t))})),(null===e||void 0===e?void 0:e._id)===t){n.next=20;break}if(!s){n.next=14;break}_(s),n.next=19;break;case 14:return n.next=16,r=null===e||void 0===e?void 0:e._id,u=t,a.W.post("/chat/new/".concat(r,"/").concat(u));case 16:o=n.sent,l=null===o||void 0===o?void 0:o.data,_(l);case 19:F(null);case 20:n.next=25;break;case 22:n.prev=22,n.t0=n.catch(0),console.error("Error creating chat:",n.t0);case 25:case"end":return n.stop()}var r,u}),n,null,[[0,22]])})));return function(e){return n.apply(this,arguments)}}(),G=function(n){var t,r=null===n||void 0===n||null===(t=n.members)||void 0===t?void 0:t.find((function(n){return n!==(null===e||void 0===e?void 0:e._id)})),i=null===I||void 0===I?void 0:I.find((function(e){return(null===e||void 0===e?void 0:e.userId)===r}));return!!i};return(0,c.jsxs)("div",{className:"Chat",children:[(0,c.jsx)("div",{className:"Left-side-chat",children:(0,c.jsxs)("div",{className:"Chat-container",children:[(0,c.jsxs)("form",{className:"userSearch",onSubmit:function(e){e.preventDefault(),T((0,b.AW)(u))},children:[(0,c.jsx)("input",{type:"text",value:u,placeholder:"Name",required:!0,onChange:function(e){return v(e.target.value)}}),(0,c.jsx)(g.Z,{disabled:B,type:"submit",children:"Search"}),(0,c.jsx)("div",{className:"Chat-list",children:""!==u&&q&&e&&(null===V||void 0===V?void 0:V.map((function(n){var t;return(0,c.jsx)("div",{onClick:function(){return X(null===n||void 0===n?void 0:n._id)},children:(null===n||void 0===n?void 0:n._id)!==(null===e||void 0===e?void 0:e._id)&&(0,c.jsx)(Z,{userId:null===n||void 0===n?void 0:n._id,name:null===n||void 0===n?void 0:n.name,avatar:null===n||void 0===n||null===(t=n.avatar)||void 0===t?void 0:t.url},null===n||void 0===n?void 0:n._id)},null===n||void 0===n?void 0:n._id)})))})]}),(0,c.jsx)("h2",{children:"Chats"}),(0,c.jsx)("div",{className:"Chat-list",children:x.map((function(n){return(0,c.jsx)("div",{onClick:function(){return _(n)},children:(0,c.jsx)(d,{data:n,currentUserId:null===e||void 0===e?void 0:e._id,online:G(n)},null===n||void 0===n?void 0:n.createdAt)},null===n||void 0===n?void 0:n._id)}))})]})}),(0,c.jsx)("div",{className:"Right-side-chat",children:(0,c.jsx)("div",{style:{width:"100%",alignSelf:"flex-end"},children:y&&(0,c.jsx)(p,{chat:y,currentUser:null===e||void 0===e?void 0:e._id,setSendMessage:F,receiveMessage:D})})})]})}}}]);
//# sourceMappingURL=561.3b9bb371.chunk.js.map